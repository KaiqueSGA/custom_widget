{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isOldStructure = exports.convert = void 0;\nconst common_1 = require(\"./common\");\nfunction convert(oldWidget) {\n  const oldDisplay = oldWidget.display || {};\n  const groupBy = oldDisplay?.group_by === \"date\" ? \"time\" : oldDisplay?.group_by;\n  const newStructure = {\n    dashboard: oldWidget.dashboard,\n    display: {\n      downsample: (0, common_1.convertDownsample)(oldDisplay),\n      group_by: groupBy ? groupBy : \"time\",\n      header_buttons: oldDisplay.header_buttons || [],\n      help: oldDisplay.help || \"\",\n      intervals: oldDisplay?.intervals && Array.isArray(oldDisplay?.intervals) ? oldDisplay.intervals.map(common_1.convertInterval) : [],\n      line_curve: oldDisplay?.line_curve || \"smooth\",\n      max_points: oldDisplay?.max_points || 5000,\n      order_by: oldDisplay?.order_by ? oldDisplay?.order_by : \"time\",\n      show_legend: true,\n      show_point_values: !!oldDisplay?.enable_labels,\n      stacked: oldDisplay?.stacked === \"realtime\",\n      theme: {\n        color: {\n          background: null,\n          header: null,\n          label: null,\n          tick: null\n        }\n      },\n      variables: []\n    },\n    id: oldWidget.id,\n    label: oldWidget.label,\n    realtime: null,\n    type: \"multiple_axis_chart\"\n  };\n  if (oldWidget?.realtime === \"variable\" && oldDisplay?.plot_by === \"time\") {\n    const timeVariable = oldWidget.data.filter(e => e?.is_global_time_data)?.[0] || {};\n    newStructure.display.x_axis = {\n      plot_by: \"variable\",\n      type: \"time\",\n      variable: {\n        origin: timeVariable?.origin || timeVariable?.origin?.id,\n        variable: timeVariable?.variables?.[0] || \"\"\n      }\n    };\n  } else if (oldDisplay?.plot_by === \"group\") {\n    newStructure.display.x_axis = {\n      plot_by: \"variable\",\n      type: \"group\",\n      variable: {\n        origin: oldDisplay?.plot_variable_group?.origin?.id || oldDisplay?.plot_variable_group?.origin,\n        variable: oldDisplay?.plot_variable_group?.variable\n      }\n    };\n  } else {\n    newStructure.display.x_axis = {\n      plot_by: \"realtime\",\n      type: \"time\"\n    };\n  }\n  if (oldDisplay?.scale === \"yes\") {\n    newStructure.display.y_axis = {\n      scale: {\n        maximum: oldDisplay?.y_max || \"\",\n        minimum: oldDisplay?.y_min || \"\",\n        type: \"fixed\"\n      }\n    };\n  } else {\n    newStructure.display.y_axis = {\n      scale: {\n        type: \"dynamic\"\n      }\n    };\n  }\n  newStructure.display.y_axis.show_metric_abbreviation = oldDisplay?.show_abbreviation || \"\";\n  if (Array.isArray(oldWidget.data)) {\n    newStructure.data = oldWidget.data; // transfers the .data property\n    newStructure.display.variables = []; // creates the variable array\n    for (const item of oldWidget.data) {\n      if (item.is_hide) {\n        // is_hide items are not visible, so we cannot\n        // put them in the variables array\n        continue;\n      }\n      for (const variable of item?.variables) {\n        const key = `${item.origin}${variable}`;\n        const reverseKey = `${variable}${item.origin}`;\n        const alias = oldDisplay.vars_labels?.[key];\n        const numberFormat = oldDisplay.vars_format?.[key];\n        const formula = (0, common_1.convertFormula)(oldDisplay.vars_formula?.[key]);\n        const color = common_1.chartColors.find(e => {\n          return !newStructure.display.variables.find(v => v?.color === e);\n        }) || \"#999\";\n        let chartType = oldDisplay?.variables_chart?.[key] || oldDisplay?.variables_chart?.[reverseKey];\n        switch (chartType) {\n          case \"spline\":\n            chartType = \"line_chart\";\n            break;\n          case \"bar\":\n            chartType = \"horizontal_bar_chart\";\n            break;\n          case \"column\":\n            chartType = \"vertical_bar_chart\";\n            break;\n          case \"area\":\n            chartType = \"area_chart\";\n            break;\n          default:\n            break;\n        }\n        newStructure.display.variables.push({\n          color,\n          origin: item.origin,\n          variable,\n          ...(alias ? {\n            alias\n          } : {}),\n          ...(numberFormat ? {\n            number_format: numberFormat\n          } : {}),\n          ...(formula ? {\n            formula\n          } : {}),\n          ...(chartType ? {\n            chart_type: chartType\n          } : {})\n        });\n      }\n    }\n  }\n  return newStructure;\n}\nexports.convert = convert;\nfunction isOldStructure(widget) {\n  const isOld = !!(widget?.display?.vars_labels || widget?.display?.vars_format || widget?.display?.numberformat || widget?.display?.hide_variables !== undefined || widget?.display?.watermark !== undefined || widget?.display?.pie_type);\n  return isOld;\n}\nexports.isOldStructure = isOldStructure;","map":{"version":3,"mappings":"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","names":["convert","oldWidget","oldDisplay","display","groupBy","group_by","newStructure","dashboard","downsample","header_buttons","help","intervals","Array","isArray","map","common_1","line_curve","max_points","order_by","show_legend","show_point_values","enable_labels","stacked","theme","color","background","header","label","tick","variables","id","realtime","type","plot_by","timeVariable","data","filter","e","is_global_time_data","x_axis","variable","origin","plot_variable_group","scale","y_axis","maximum","y_max","minimum","y_min","show_metric_abbreviation","show_abbreviation","item","is_hide","key","reverseKey","alias","vars_labels","numberFormat","vars_format","formula","vars_formula","find","v","chartType","variables_chart","push","number_format","chart_type","exports","isOldStructure","widget","isOld","numberformat","hide_variables","undefined","watermark","pie_type"],"sources":["C:\\Users\\yudji\\OneDrive\\Documentos\\SGA\\WIDGETS\\custom_widgets\\project\\node_modules\\@tago-io\\sdk\\src\\modules\\Migration\\multipleaxischart.ts"],"sourcesContent":["// ? ==================================== (c) TagoIO ====================================\n// * What is this file?\n//     Migration of old MULTIPLE AXIS CHART to new MULTIPLE AXIS CHART\n// ? ====================================================================================\nimport { WidgetInfo } from \"../Account/dashboards.types\";\nimport { chartColors, convertDownsample, convertFormula, convertInterval } from \"./common\";\n\nexport function convert(oldWidget: any): WidgetInfo {\n  const oldDisplay = oldWidget.display || {};\n  const groupBy = oldDisplay?.group_by === \"date\" ? \"time\" : oldDisplay?.group_by;\n\n  const newStructure: any = {\n    dashboard: oldWidget.dashboard,\n    display: {\n      downsample: convertDownsample(oldDisplay),\n      group_by: groupBy ? groupBy : \"time\",\n      header_buttons: oldDisplay.header_buttons || [],\n      help: oldDisplay.help || \"\",\n      intervals:\n        oldDisplay?.intervals && Array.isArray(oldDisplay?.intervals) ? oldDisplay.intervals.map(convertInterval) : [],\n      line_curve: oldDisplay?.line_curve || \"smooth\",\n      max_points: oldDisplay?.max_points || 5000,\n      order_by: oldDisplay?.order_by ? oldDisplay?.order_by : \"time\",\n      show_legend: true,\n      show_point_values: !!oldDisplay?.enable_labels,\n      stacked: oldDisplay?.stacked === \"realtime\",\n      theme: {\n        color: {\n          background: null,\n          header: null,\n          label: null,\n          tick: null,\n        },\n      },\n      variables: [],\n    },\n    id: oldWidget.id,\n    label: oldWidget.label,\n    realtime: null,\n    type: \"multiple_axis_chart\",\n  };\n\n  if (oldWidget?.realtime === \"variable\" && oldDisplay?.plot_by === \"time\") {\n    const timeVariable = oldWidget.data.filter((e: any) => e?.is_global_time_data)?.[0] || {};\n    newStructure.display.x_axis = {\n      plot_by: \"variable\",\n      type: \"time\",\n      variable: {\n        origin: timeVariable?.origin || timeVariable?.origin?.id,\n        variable: timeVariable?.variables?.[0] || \"\",\n      },\n    };\n  } else if (oldDisplay?.plot_by === \"group\") {\n    newStructure.display.x_axis = {\n      plot_by: \"variable\",\n      type: \"group\",\n      variable: {\n        origin: oldDisplay?.plot_variable_group?.origin?.id || oldDisplay?.plot_variable_group?.origin,\n        variable: oldDisplay?.plot_variable_group?.variable,\n      },\n    };\n  } else {\n    newStructure.display.x_axis = {\n      plot_by: \"realtime\",\n      type: \"time\",\n    };\n  }\n\n  if (oldDisplay?.scale === \"yes\") {\n    newStructure.display.y_axis = {\n      scale: {\n        maximum: oldDisplay?.y_max || \"\",\n        minimum: oldDisplay?.y_min || \"\",\n        type: \"fixed\",\n      },\n    };\n  } else {\n    newStructure.display.y_axis = {\n      scale: {\n        type: \"dynamic\",\n      },\n    };\n  }\n\n  newStructure.display.y_axis.show_metric_abbreviation = oldDisplay?.show_abbreviation || \"\";\n\n  if (Array.isArray(oldWidget.data)) {\n    newStructure.data = oldWidget.data; // transfers the .data property\n\n    newStructure.display.variables = []; // creates the variable array\n\n    for (const item of oldWidget.data) {\n      if (item.is_hide) {\n        // is_hide items are not visible, so we cannot\n        // put them in the variables array\n        continue;\n      }\n\n      for (const variable of item?.variables) {\n        const key = `${item.origin}${variable}`;\n        const reverseKey = `${variable}${item.origin}`;\n\n        const alias = oldDisplay.vars_labels?.[key];\n        const numberFormat = oldDisplay.vars_format?.[key];\n        const formula = convertFormula(oldDisplay.vars_formula?.[key]);\n        const color =\n          chartColors.find((e) => {\n            return !newStructure.display.variables.find((v: any) => v?.color === e);\n          }) || \"#999\";\n\n        let chartType = oldDisplay?.variables_chart?.[key] || oldDisplay?.variables_chart?.[reverseKey];\n\n        switch (chartType) {\n          case \"spline\":\n            chartType = \"line_chart\";\n            break;\n          case \"bar\":\n            chartType = \"horizontal_bar_chart\";\n            break;\n          case \"column\":\n            chartType = \"vertical_bar_chart\";\n            break;\n          case \"area\":\n            chartType = \"area_chart\";\n            break;\n          default:\n            break;\n        }\n\n        newStructure.display.variables.push({\n          color,\n          origin: item.origin,\n          variable,\n          ...(alias ? { alias } : {}),\n          ...(numberFormat ? { number_format: numberFormat } : {}),\n          ...(formula ? { formula } : {}),\n          ...(chartType ? { chart_type: chartType } : {}),\n        });\n      }\n    }\n  }\n\n  return newStructure;\n}\n\nexport function isOldStructure(widget: any) {\n  const isOld = !!(\n    widget?.display?.vars_labels ||\n    widget?.display?.vars_format ||\n    widget?.display?.numberformat ||\n    widget?.display?.hide_variables !== undefined ||\n    widget?.display?.watermark !== undefined ||\n    widget?.display?.pie_type\n  );\n\n  return isOld;\n}\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}
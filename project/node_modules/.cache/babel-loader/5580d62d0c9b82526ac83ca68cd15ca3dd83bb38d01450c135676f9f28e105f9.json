{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isOldStructure = exports.convert = void 0;\nconst common_1 = require(\"./common/\");\nfunction convert(oldWidget) {\n  const oldDisplay = oldWidget.display || {};\n  const newStructure = {\n    dashboard: oldWidget.dashboard,\n    display: {\n      allow_add: false,\n      allow_edit: false,\n      allow_embed_url: false,\n      allow_label: false,\n      allow_pin_color: false,\n      allow_remove: false,\n      allow_zoom: false,\n      aspect_ratio: oldDisplay?.aspect_ratio || [],\n      background: {},\n      background_path: oldDisplay?.background_path || \"\",\n      background_type: oldDisplay?.background_type || \"\",\n      header_buttons: oldDisplay.header_buttons || [],\n      help: oldDisplay.help || \"\",\n      max_points: 300,\n      object_fit: \"contain\",\n      occupy_whole_widget: false,\n      pin_size: \"big\",\n      show_last_update: false,\n      theme: {\n        color: {\n          background: null,\n          button_background: null,\n          button_icon: null,\n          header: null,\n          infobox_background: null,\n          infobox_text: null\n        }\n      },\n      title_window: \"\",\n      variables: []\n    },\n    id: oldWidget.id,\n    label: oldWidget.label,\n    realtime: null,\n    type: \"compose\"\n  };\n  if (Array.isArray(oldWidget.data)) {\n    newStructure.data = oldWidget.data; // transfers the .data property\n    newStructure.display.variables = []; // creates the variable array\n    for (const item of oldWidget.data) {\n      if (item.is_hide) {\n        // is_hide items are not visible in the columns, so we cannot\n        // put them in the variables array\n        continue;\n      }\n      for (const variable of item.variables) {\n        const key = `${item.origin}${variable}`;\n        const alias = oldDisplay.vars_labels?.[key];\n        const numberFormat = oldDisplay.vars_format?.[key];\n        const url = oldDisplay.vars_url?.[key]?.url || null;\n        const urlLabel = oldDisplay.vars_url?.[key]?.alias || null;\n        const embed = oldDisplay.vars_iframe?.[key] || null;\n        const colorConditions = [];\n        const icon = oldDisplay.vars_icons?.[key] || null;\n        if (icon && icon?.url) {\n          colorConditions.push({\n            color: icon?.color ? icon.color : \"rgb(49, 60, 70)\",\n            condition: \"*\",\n            url: icon.url\n          });\n        }\n        newStructure.display.variables.push({\n          color_conditions: colorConditions,\n          origin: item.origin,\n          override_color: false,\n          variable,\n          ...(alias ? {\n            alias\n          } : {}),\n          ...(numberFormat ? {\n            number_format: numberFormat\n          } : {}),\n          ...(url ? {\n            external_url: url\n          } : {}),\n          ...(urlLabel ? {\n            external_url_label: urlLabel\n          } : {}),\n          ...(embed ? {\n            embed: (0, common_1.removeHttpFromURL)(embed)\n          } : {})\n        });\n      }\n    }\n  }\n  return newStructure;\n}\nexports.convert = convert;\nfunction isOldStructure(widget) {\n  const isOld = !!(widget?.display?.vars_labels || widget?.display?.vars_format || widget?.display?.vars_formula || widget?.display?.numberformat || widget?.display?.column_alignments || widget?.display?.hide_variables !== undefined || widget?.display?.watermark !== undefined);\n  return isOld;\n}\nexports.isOldStructure = isOldStructure;","map":{"version":3,"mappings":"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","names":["convert","oldWidget","oldDisplay","display","newStructure","dashboard","allow_add","allow_edit","allow_embed_url","allow_label","allow_pin_color","allow_remove","allow_zoom","aspect_ratio","background","background_path","background_type","header_buttons","help","max_points","object_fit","occupy_whole_widget","pin_size","show_last_update","theme","color","button_background","button_icon","header","infobox_background","infobox_text","title_window","variables","id","label","realtime","type","Array","isArray","data","item","is_hide","variable","key","origin","alias","vars_labels","numberFormat","vars_format","url","vars_url","urlLabel","embed","vars_iframe","colorConditions","icon","vars_icons","push","condition","color_conditions","override_color","number_format","external_url","external_url_label","exports","isOldStructure","widget","isOld","vars_formula","numberformat","column_alignments","hide_variables","undefined","watermark"],"sources":["C:\\Users\\kaique\\Documents\\SGA\\widget\\project\\node_modules\\@tago-io\\sdk\\src\\modules\\Migration\\compose.ts"],"sourcesContent":["// ? ==================================== (c) TagoIO ====================================\r\n// * What is this file?\r\n//     Migration of old COMPOSE to new COMPOSE\r\n// ? ====================================================================================\r\nimport { WidgetInfo } from \"../Account/dashboards.types\";\r\nimport { removeHttpFromURL } from \"./common/\";\r\n\r\nexport function convert(oldWidget: any): WidgetInfo {\r\n  const oldDisplay = oldWidget.display || {};\r\n\r\n  const newStructure: any = {\r\n    dashboard: oldWidget.dashboard,\r\n    display: {\r\n      allow_add: false,\r\n      allow_edit: false,\r\n      allow_embed_url: false,\r\n      allow_label: false,\r\n      allow_pin_color: false,\r\n      allow_remove: false,\r\n      allow_zoom: false,\r\n      aspect_ratio: oldDisplay?.aspect_ratio || [],\r\n      background: {},\r\n      background_path: oldDisplay?.background_path || \"\",\r\n      background_type: oldDisplay?.background_type || \"\",\r\n      header_buttons: oldDisplay.header_buttons || [],\r\n      help: oldDisplay.help || \"\",\r\n      max_points: 300,\r\n      object_fit: \"contain\",\r\n      occupy_whole_widget: false,\r\n      pin_size: \"big\",\r\n      show_last_update: false,\r\n      theme: {\r\n        color: {\r\n          background: null,\r\n          button_background: null,\r\n          button_icon: null,\r\n          header: null,\r\n          infobox_background: null,\r\n          infobox_text: null,\r\n        },\r\n      },\r\n      title_window: \"\",\r\n      variables: [],\r\n    },\r\n    id: oldWidget.id,\r\n    label: oldWidget.label,\r\n    realtime: null,\r\n    type: \"compose\",\r\n  };\r\n\r\n  if (Array.isArray(oldWidget.data)) {\r\n    newStructure.data = oldWidget.data; // transfers the .data property\r\n\r\n    newStructure.display.variables = []; // creates the variable array\r\n\r\n    for (const item of oldWidget.data) {\r\n      if (item.is_hide) {\r\n        // is_hide items are not visible in the columns, so we cannot\r\n        // put them in the variables array\r\n        continue;\r\n      }\r\n\r\n      for (const variable of item.variables) {\r\n        const key = `${item.origin}${variable}`;\r\n\r\n        const alias = oldDisplay.vars_labels?.[key];\r\n        const numberFormat = oldDisplay.vars_format?.[key];\r\n        const url = oldDisplay.vars_url?.[key]?.url || null;\r\n        const urlLabel = oldDisplay.vars_url?.[key]?.alias || null;\r\n        const embed = oldDisplay.vars_iframe?.[key] || null;\r\n\r\n        const colorConditions = [];\r\n        const icon = oldDisplay.vars_icons?.[key] || null;\r\n        if (icon && icon?.url) {\r\n          colorConditions.push({\r\n            color: icon?.color ? icon.color : \"rgb(49, 60, 70)\",\r\n            condition: \"*\",\r\n            url: icon.url,\r\n          });\r\n        }\r\n\r\n        newStructure.display.variables.push({\r\n          color_conditions: colorConditions,\r\n          origin: item.origin,\r\n          override_color: false,\r\n          variable,\r\n          ...(alias ? { alias } : {}),\r\n          ...(numberFormat ? { number_format: numberFormat } : {}),\r\n          ...(url ? { external_url: url } : {}),\r\n          ...(urlLabel ? { external_url_label: urlLabel } : {}),\r\n          ...(embed ? { embed: removeHttpFromURL(embed) } : {}),\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  return newStructure;\r\n}\r\n\r\nexport function isOldStructure(widget: any): boolean {\r\n  const isOld = !!(\r\n    widget?.display?.vars_labels ||\r\n    widget?.display?.vars_format ||\r\n    widget?.display?.vars_formula ||\r\n    widget?.display?.numberformat ||\r\n    widget?.display?.column_alignments ||\r\n    widget?.display?.hide_variables !== undefined ||\r\n    widget?.display?.watermark !== undefined\r\n  );\r\n\r\n  return isOld;\r\n}\r\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}
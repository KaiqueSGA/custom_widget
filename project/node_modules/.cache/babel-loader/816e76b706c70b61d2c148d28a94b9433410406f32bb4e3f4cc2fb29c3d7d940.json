{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/yudji/OneDrive/Documentos/SGA/WIDGETS/mqtt_wid/dash_mqtt/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/yudji/OneDrive/Documentos/SGA/WIDGETS/mqtt_wid/dash_mqtt/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/yudji/OneDrive/Documentos/SGA/WIDGETS/mqtt_wid/dash_mqtt/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import'./App.css';import React,{useEffect,useState}from'react';import{ToastContainer,toast}from'react-toastify';import'react-toastify/dist/ReactToastify.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var _require=require('@tago-io/sdk'),Account=_require.Account,Device=_require.Device,Services=_require.Services;var notify=function notify(message){return toast.success(message);};var error=function error(message){return toast.error(message);};var render=0;function App(){var account=new Account({token:\"a394b4c9-7ea7-4346-bbe1-ddb35f9bc948\"});var _useState=useState([]),_useState2=_slicedToArray(_useState,2),arrayOfdevices=_useState2[0],setArray=_useState2[1];function listdevices(){return _listdevices.apply(this,arguments);}function _listdevices(){_listdevices=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var listResponse;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return account.devices.list();case 2:listResponse=_context.sent;render++;render===1?setArray(listResponse):console.log();case 5:case\"end\":return _context.stop();}}},_callee);}));return _listdevices.apply(this,arguments);}useEffect(function(){listdevices();});window.TagoIO.onStart(function(widget){window.widget=widget;});window.TagoIO.ready();function insertParam(){return _insertParam.apply(this,arguments);}function _insertParam(){_insertParam=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){var selectDevice,device_token,device_name,parameters_values,get_configuration_parameters,send_mqtt_to_device;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:selectDevice=document.getElementById(\"devices\");device_token=selectDevice.options[selectDevice.selectedIndex].value.split(',')[0];device_name=selectDevice.options[selectDevice.selectedIndex].value.split(\",\")[1];parameters_values=new Array();get_configuration_parameters=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var myDevice,result;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;myDevice=new Device({token:device_token});_context2.next=4;return myDevice.getParameters();case 4:result=_context2.sent;result.forEach(function(parameter){return parameters_values.push({key:parameter.key,value:parameter.value});});//in this code line, i'm catching all the values of device's configuration parameter and i'm storing in an array. \n_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);error(\"\".concat(_context2.t0,\", please verify the device's tag. Something can be wrong\"));case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function get_configuration_parameters(){return _ref.apply(this,arguments);};}();_context4.next=7;return get_configuration_parameters();case 7:send_mqtt_to_device=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var formated_string,options,MQTT;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:formated_string=\"ID=1234567890ABCDEF,MODE=\".concat(parameters_values.find(function(parameter){return parameter.key==='MODE';}).value,\",TIMER_GPRS=\").concat(parameters_values.find(function(parameter){return parameter.key==='TIMER_GPRS';}).value,\",TIMER_GPS=\").concat(parameters_values.find(function(parameter){return parameter.key==='TIMER_GPS';}).value,\",TIMER_SMS=\").concat(parameters_values.find(function(parameter){return parameter.key==='TIMER_SMS';}).value,\",CMD=\").concat(parameters_values.find(function(parameter){return parameter.key==='CMD';}).value);options={retain:false,qos:2};MQTT=new Services({token:\"61f848bb-e3d0-4a13-836a-ef90d84834c3\"}).MQTT;MQTT.publish({bucket:arrayOfdevices.find(function(dev){return dev.name===device_name;}).id,//device's bucket ? FROM CONTEXT OR SCOPE\nmessage:JSON.stringify(formated_string),//the MQTT message\ntopic:arrayOfdevices.find(function(dev){return dev.name===device_name;}).tags.find(function(tag){return tag.key===\"ESN\";}).value,//ESN or IMEI\noptions:options}).then(function(resp){return notify(resp);}).catch(function(err){return error(err);});case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function send_mqtt_to_device(){return _ref2.apply(this,arguments);};}();send_mqtt_to_device();case 9:case\"end\":return _context4.stop();}}},_callee4);}));return _insertParam.apply(this,arguments);}return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(ToastContainer,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"box\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"cabecalho\",children:/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:\"Enviar Comando\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"fieldOfSelection\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\" label_dev\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"drop\",alt:\"\",src:\"https://img.icons8.com/external-zen-filled-royyan-wijaya/2x/external-list-dropdown-business-zen-filled-royyan-wijaya.png\"}),/*#__PURE__*/_jsx(\"div\",{className:\"title_label\",children:\"Select the device to configure it\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"input\",children:/*#__PURE__*/_jsx(\"select\",{id:\"devices\",className:\"devices\",children:arrayOfdevices.map(function(item){try{var device_token=item.tags.find(function(dev){return dev.key===\"device_token\";});return/*#__PURE__*/_jsxs(\"option\",{value:\"\".concat(device_token.value,\",\").concat(item.name),children:[\" \",item.name,\" \"]});}catch(err){error(err);}})})}),/*#__PURE__*/_jsx(\"div\",{className:\"rodape\",children:/*#__PURE__*/_jsx(\"button\",{className:\"button\",onClick:insertParam,children:\"Sent MQTT Message\"})})]})]})]});}export default App;","map":{"version":3,"names":["React","useEffect","useState","ToastContainer","toast","require","Account","Device","Services","notify","message","success","error","render","App","account","token","arrayOfdevices","setArray","listdevices","devices","list","listResponse","console","log","window","TagoIO","onStart","widget","ready","insertParam","selectDevice","document","getElementById","device_token","options","selectedIndex","value","split","device_name","parameters_values","Array","get_configuration_parameters","myDevice","getParameters","result","forEach","parameter","push","key","send_mqtt_to_device","formated_string","find","retain","qos","MQTT","publish","bucket","dev","name","id","JSON","stringify","topic","tags","tag","then","resp","catch","err","map","item"],"sources":["C:/Users/yudji/OneDrive/Documentos/SGA/WIDGETS/mqtt_wid/dash_mqtt/src/App.js"],"sourcesContent":["import './App.css';\nimport React, { useEffect, useState } from 'react';\nimport { ToastContainer, toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nconst {Account, Device, Services} = require('@tago-io/sdk'); \n\n    \n    const notify = (message) => toast.success(message);\n    const error = (message) => toast.error(message) \n    \n\n\nlet render = 0;\nfunction App() {\n   const account = new Account({token:\"a394b4c9-7ea7-4346-bbe1-ddb35f9bc948\"});\n   const [arrayOfdevices,setArray] = useState([]);\n    \n\n    async function listdevices(){\n        let listResponse =  await account.devices.list();\n        \n        render++;\n           render === 1 ? setArray(listResponse)\n                                     : console.log()\n       } \n\n\n        useEffect( () => {\n            listdevices()\n        } )\n        \n   \n        window.TagoIO.onStart((widget) => {\n            window.widget = widget;\n        })\n        window.TagoIO.ready();\n \n       \n\n        async function insertParam(){\n            let selectDevice = document.getElementById(\"devices\");\n            let device_token = selectDevice.options[selectDevice.selectedIndex].value.split(',')[0];\n            let device_name = selectDevice.options[selectDevice.selectedIndex].value.split(\",\")[1];          \n            \n\n          let parameters_values = new Array();\n          const get_configuration_parameters = async () => {\n             try{\n                  const myDevice = new Device({ token: device_token });\n\n                  const result = await myDevice.getParameters();\n                  result.forEach((parameter) => parameters_values.push({\n                       key:parameter.key,\n                       value:parameter.value\n                    })\n                  );//in this code line, i'm catching all the values of device's configuration parameter and i'm storing in an array. \n\n              }catch(err){\n                error(`${err}, please verify the device's tag. Something can be wrong`)\n              }\n\n            };await get_configuration_parameters();\n            \n\n            \n            \n\n            const send_mqtt_to_device = async () => {\n    \n                    let formated_string = `ID=1234567890ABCDEF,MODE=${ (parameters_values.find((parameter) => {return parameter.key === 'MODE'})).value  },TIMER_GPRS=${ (parameters_values.find((parameter) => {return parameter.key === 'TIMER_GPRS'})).value  },TIMER_GPS=${ (parameters_values.find((parameter) => {return parameter.key === 'TIMER_GPS'})).value  },TIMER_SMS=${ (parameters_values.find((parameter) => {return parameter.key === 'TIMER_SMS'})).value  },CMD=${ (parameters_values.find((parameter) => {return parameter.key === 'CMD'})).value  }`;\n                    const options = { retain: false, qos: 2 };\n                     \n                    \n                    const MQTT = new Services({ token: \"61f848bb-e3d0-4a13-836a-ef90d84834c3\"}).MQTT;\n                     MQTT.publish({\n                        bucket: (arrayOfdevices.find((dev) => dev.name === device_name)).id , //device's bucket ? FROM CONTEXT OR SCOPE\n                        message: JSON.stringify(formated_string), //the MQTT message\n                        topic: (arrayOfdevices.find((dev) => dev.name === device_name)).tags.find(tag => { return tag.key === \"ESN\"}).value, //ESN or IMEI\n                        options,\n                    }).then((resp) => notify(resp))   \n                      .catch((err) => error(err))\n\n            };send_mqtt_to_device();\n\n      }\n\n\n        return(\n             <div className=\"container\">\n                <ToastContainer />\n                    <div className=\"box\">\n                        \n                        <div className =\"cabecalho\">\n                            <div className =\"title\">Enviar Comando</div>\n                        </div>\n                        \n                        \n                        <div className =\"fieldOfSelection\">\n                \n                            <div className=\" label_dev\">\n                                <img className =\"drop\" alt='' src=\"https://img.icons8.com/external-zen-filled-royyan-wijaya/2x/external-list-dropdown-business-zen-filled-royyan-wijaya.png\" />\n                                <div className =\"title_label\">Select the device to configure it</div> \n                            </div>\n                \n                \n                              <div className=\"input\">\n                                    <select id=\"devices\" className =\"devices\">\n                                    {arrayOfdevices.map((item) =>{\n                                        try{\n                                            let device_token = item.tags.find(dev => {return dev.key === \"device_token\"});\n                                            return(\n                                                <option value={`${device_token.value},${item.name}`}> {item.name} </option>\n                                            )\n                                        }catch(err){\n                                           error(err)\n                                        }\n                                      \n                                    })}\n                                    </select>\n                                </div>  \n                                \n                \n                            \n                \n                            <div className=\"rodape\">\n                                 <button className=\"button\" onClick={insertParam} >\n                                    Sent MQTT Message\n                                </button> \n                            </div>\n                \n                \n                        </div>\n                        \n                    \n                \n                    </div>  \n                    \n                   \n                </div>\n           \n        )\n}\n\nexport default App;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"\"use strict\";\n\nvar _objectSpread = require(\"C:/Users/yudji/OneDrive/Documentos/SGA/WIDGETS/mqtt_wid/dash_mqtt/node_modules/@babel/runtime/helpers/objectSpread2.js\").default;\nvar _createForOfIteratorHelper = require(\"C:/Users/yudji/OneDrive/Documentos/SGA/WIDGETS/mqtt_wid/dash_mqtt/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isOldStructure = exports.convert = exports.convertLayerData = void 0;\nvar common_1 = require(\"./common\");\nfunction convertLayerData(widget, oldWidgetData) {\n  var _widget$display;\n  var fields = [];\n  var layerVariable = widget === null || widget === void 0 ? void 0 : (_widget$display = widget.display) === null || _widget$display === void 0 ? void 0 : _widget$display.layer_variable;\n  // Map old keys (Origin id + Variable name) to new key (Origin)\n  var mapOldToNew = {};\n  var _iterator = _createForOfIteratorHelper(widget.data),\n    _step;\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var _dt$variables, _layerVariable$origin, _dt$variables2;\n      var dt = _step.value;\n      if (dt !== null && dt !== void 0 && (_dt$variables = dt.variables) !== null && _dt$variables !== void 0 && _dt$variables[0] && ((layerVariable === null || layerVariable === void 0 ? void 0 : (_layerVariable$origin = layerVariable.origin) === null || _layerVariable$origin === void 0 ? void 0 : _layerVariable$origin.id) !== (dt === null || dt === void 0 ? void 0 : dt.origin) || (layerVariable === null || layerVariable === void 0 ? void 0 : layerVariable.variable) !== (dt === null || dt === void 0 ? void 0 : (_dt$variables2 = dt.variables) === null || _dt$variables2 === void 0 ? void 0 : _dt$variables2[0]))) {\n        var _dt$variables3;\n        var key = \"\".concat(dt === null || dt === void 0 ? void 0 : dt.origin).concat(dt === null || dt === void 0 ? void 0 : (_dt$variables3 = dt.variables) === null || _dt$variables3 === void 0 ? void 0 : _dt$variables3[0]);\n        mapOldToNew[key] = dt === null || dt === void 0 ? void 0 : dt.origin;\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n  var _iterator2 = _createForOfIteratorHelper(oldWidgetData),\n    _step2;\n  try {\n    for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n      var _x$data, _x$data$variables, _x$data2, _layerVariable$origin2, _x$data3, _x$data3$variables;\n      var x = _step2.value;\n      if (x !== null && x !== void 0 && (_x$data = x.data) !== null && _x$data !== void 0 && (_x$data$variables = _x$data.variables) !== null && _x$data$variables !== void 0 && _x$data$variables[0] && (x === null || x === void 0 ? void 0 : (_x$data2 = x.data) === null || _x$data2 === void 0 ? void 0 : _x$data2.origin) === (layerVariable === null || layerVariable === void 0 ? void 0 : (_layerVariable$origin2 = layerVariable.origin) === null || _layerVariable$origin2 === void 0 ? void 0 : _layerVariable$origin2.id) && (x === null || x === void 0 ? void 0 : (_x$data3 = x.data) === null || _x$data3 === void 0 ? void 0 : (_x$data3$variables = _x$data3.variables) === null || _x$data3$variables === void 0 ? void 0 : _x$data3$variables[0]) === (layerVariable === null || layerVariable === void 0 ? void 0 : layerVariable.variable)) {\n        var _iterator3 = _createForOfIteratorHelper(x === null || x === void 0 ? void 0 : x.result),\n          _step3;\n        try {\n          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n            var _y$metadata;\n            var y = _step3.value;\n            var oldFixedPos = (y === null || y === void 0 ? void 0 : (_y$metadata = y.metadata) === null || _y$metadata === void 0 ? void 0 : _y$metadata.fixed_position) || {};\n            var keysFixedPos = Object.keys(oldFixedPos);\n            var newFixedPos = _objectSpread({}, oldFixedPos);\n            for (var _i = 0, _keysFixedPos = keysFixedPos; _i < _keysFixedPos.length; _i++) {\n              var k = _keysFixedPos[_i];\n              var newK = mapOldToNew === null || mapOldToNew === void 0 ? void 0 : mapOldToNew[k];\n              if (newK) {\n                newFixedPos[newK] = _objectSpread({}, oldFixedPos[k]);\n              }\n            }\n            fields.push(_objectSpread(_objectSpread({}, y), {}, {\n              metadata: _objectSpread(_objectSpread({}, y === null || y === void 0 ? void 0 : y.metadata), {}, {\n                fixed_position: newFixedPos\n              })\n            }));\n          }\n        } catch (err) {\n          _iterator3.e(err);\n        } finally {\n          _iterator3.f();\n        }\n      }\n    }\n  } catch (err) {\n    _iterator2.e(err);\n  } finally {\n    _iterator2.f();\n  }\n  return fields;\n}\nexports.convertLayerData = convertLayerData;\nfunction convert(oldWidget) {\n  var oldDisplay = oldWidget.display || {};\n  var newStructure = {\n    dashboard: oldWidget.dashboard,\n    display: {\n      // Image marker display properties\n      allow_add: (oldDisplay === null || oldDisplay === void 0 ? void 0 : oldDisplay.allow_add) || true,\n      allow_edit: (oldDisplay === null || oldDisplay === void 0 ? void 0 : oldDisplay.allow_move) || true,\n      allow_edit_layers: (oldDisplay === null || oldDisplay === void 0 ? void 0 : oldDisplay.allow_edit_layers) || true,\n      allow_embed_url: !!(oldDisplay !== null && oldDisplay !== void 0 && oldDisplay.allow_embed_url),\n      allow_image_url: !!(oldDisplay !== null && oldDisplay !== void 0 && oldDisplay.allow_image_url),\n      allow_label: !!(oldDisplay !== null && oldDisplay !== void 0 && oldDisplay.allow_label),\n      allow_pin_color: !!(oldDisplay !== null && oldDisplay !== void 0 && oldDisplay.allow_pin_color),\n      allow_remove: (oldDisplay === null || oldDisplay === void 0 ? void 0 : oldDisplay.allow_remove) || true,\n      allow_zoom: false,\n      connect_markers: !!(oldDisplay !== null && oldDisplay !== void 0 && oldDisplay.connect_markers),\n      filter_by: \"device\",\n      filter_truncate_direction: \"end\",\n      geofence: {\n        enable_user: false,\n        events_type: \"static\",\n        limit: 100,\n        type_enable_user: \"all\"\n      },\n      infobox_config: {\n        behavior: \"landscape\",\n        date_format: \"\",\n        object_fit: \"contain\",\n        position: \"top\",\n        show_one_infobox: true\n      },\n      layer: (oldDisplay === null || oldDisplay === void 0 ? void 0 : oldDisplay.layer_variable) || {},\n      layer_sub_type: (oldDisplay === null || oldDisplay === void 0 ? void 0 : oldDisplay.layer_sub_type) === \"basic\" ? \"basic\" : \"advanced\",\n      markdown_box: \"\",\n      max_points: (oldDisplay === null || oldDisplay === void 0 ? void 0 : oldDisplay.max_points) || 1,\n      object_fit: \"contain\",\n      occupy_whole_widget: false,\n      show_filter: false,\n      show_last_update: false,\n      show_polyline: false,\n      show_side_value: false,\n      theme: {\n        color: {\n          background: null,\n          button_background: null,\n          button_icon: null,\n          header: null,\n          infobox_background: null,\n          infobox_header: null,\n          infobox_text: null,\n          zoom_button_background: null,\n          zoom_button_border: null,\n          zoom_button_icon: null\n        }\n      },\n      tools_title: (oldDisplay === null || oldDisplay === void 0 ? void 0 : oldDisplay.title_window) || \"Tools\",\n      // Default properties for widgets\n      header_buttons: oldDisplay.header_buttons || [],\n      help: oldDisplay.help || \"\",\n      variables: []\n    },\n    id: oldWidget.id,\n    label: oldWidget.label,\n    realtime: null,\n    type: \"image_marker\"\n  };\n  if (Array.isArray(oldWidget.data)) {\n    newStructure.data = oldWidget.data; // transfers the .data property\n    newStructure.display.variables = []; // creates the variable array\n    var _iterator4 = _createForOfIteratorHelper(oldWidget.data),\n      _step4;\n    try {\n      for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n        var item = _step4.value;\n        if (item.is_hide) {\n          // is_hide items are not visible in the columns, so we cannot\n          // put them in the variables array\n          continue;\n        }\n        var _iterator5 = _createForOfIteratorHelper(item.variables),\n          _step5;\n        try {\n          for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n            var _oldDisplay$vars_labe, _oldDisplay$vars_form, _oldDisplay$vars_form2, _oldDisplay$vars_cond, _oldDisplay$vars_url, _oldDisplay$vars_imag, _oldDisplay$vars_embe, _oldDisplay$vars_link;\n            var variable = _step5.value;\n            var key = \"\".concat(item.origin).concat(variable);\n            var alias = (_oldDisplay$vars_labe = oldDisplay.vars_labels) === null || _oldDisplay$vars_labe === void 0 ? void 0 : _oldDisplay$vars_labe[key];\n            var numberFormat = (_oldDisplay$vars_form = oldDisplay.vars_format) === null || _oldDisplay$vars_form === void 0 ? void 0 : _oldDisplay$vars_form[key];\n            var formula = (0, common_1.convertFormula)((_oldDisplay$vars_form2 = oldDisplay.vars_formula) === null || _oldDisplay$vars_form2 === void 0 ? void 0 : _oldDisplay$vars_form2[key]);\n            var varConditions = oldDisplay === null || oldDisplay === void 0 ? void 0 : (_oldDisplay$vars_cond = oldDisplay.vars_conditions) === null || _oldDisplay$vars_cond === void 0 ? void 0 : _oldDisplay$vars_cond[key];\n            var varUrl = oldDisplay === null || oldDisplay === void 0 ? void 0 : (_oldDisplay$vars_url = oldDisplay.vars_url) === null || _oldDisplay$vars_url === void 0 ? void 0 : _oldDisplay$vars_url[key];\n            var varImage = oldDisplay === null || oldDisplay === void 0 ? void 0 : (_oldDisplay$vars_imag = oldDisplay.vars_images) === null || _oldDisplay$vars_imag === void 0 ? void 0 : _oldDisplay$vars_imag[key];\n            var varEmbed = oldDisplay === null || oldDisplay === void 0 ? void 0 : (_oldDisplay$vars_embe = oldDisplay.vars_embed) === null || _oldDisplay$vars_embe === void 0 ? void 0 : _oldDisplay$vars_embe[key];\n            var externalUrl = varUrl ? _objectSpread(_objectSpread({}, varUrl !== null && varUrl !== void 0 && varUrl.url ? {\n              external_url: varUrl === null || varUrl === void 0 ? void 0 : varUrl.url\n            } : {}), varUrl !== null && varUrl !== void 0 && varUrl.alias ? {\n              external_url_label: varUrl === null || varUrl === void 0 ? void 0 : varUrl.alias\n            } : {}) : null;\n            var urlType = oldDisplay === null || oldDisplay === void 0 ? void 0 : (_oldDisplay$vars_link = oldDisplay.vars_link_type) === null || _oldDisplay$vars_link === void 0 ? void 0 : _oldDisplay$vars_link[key];\n            newStructure.display.variables.push(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({\n              origin: item.origin,\n              override_color: !(oldDisplay !== null && oldDisplay !== void 0 && oldDisplay.override_color),\n              url_type: urlType || \"image\",\n              variable: variable\n            }, alias ? {\n              alias: alias\n            } : {}), numberFormat ? {\n              number_format: numberFormat\n            } : {}), formula ? {\n              formula: formula\n            } : {}), varConditions ? {\n              color_conditions: varConditions\n            } : {}), externalUrl ? _objectSpread({}, externalUrl) : {}), varImage ? {\n              img_pin: varImage\n            } : {}), varEmbed ? {\n              embed: varEmbed\n            } : {}));\n          }\n        } catch (err) {\n          _iterator5.e(err);\n        } finally {\n          _iterator5.f();\n        }\n      }\n    } catch (err) {\n      _iterator4.e(err);\n    } finally {\n      _iterator4.f();\n    }\n  }\n  return newStructure;\n}\nexports.convert = convert;\nfunction isOldStructure(widget) {\n  var _widget$display2, _widget$display3, _widget$display4, _widget$display5;\n  var isOld = !!(widget !== null && widget !== void 0 && (_widget$display2 = widget.display) !== null && _widget$display2 !== void 0 && _widget$display2.vars_labels || widget !== null && widget !== void 0 && (_widget$display3 = widget.display) !== null && _widget$display3 !== void 0 && _widget$display3.vars_formula || widget !== null && widget !== void 0 && (_widget$display4 = widget.display) !== null && _widget$display4 !== void 0 && _widget$display4.numberformat || (widget === null || widget === void 0 ? void 0 : (_widget$display5 = widget.display) === null || _widget$display5 === void 0 ? void 0 : _widget$display5.watermark) !== undefined);\n  return isOld;\n}\nexports.isOldStructure = isOldStructure;","map":{"version":3,"mappings":"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","names":["convertLayerData","widget","oldWidgetData","fields","layerVariable","display","layer_variable","mapOldToNew","data","dt","variables","origin","id","variable","key","x","result","y","oldFixedPos","metadata","fixed_position","keysFixedPos","Object","keys","newFixedPos","k","newK","push","exports","convert","oldWidget","oldDisplay","newStructure","dashboard","allow_add","allow_edit","allow_move","allow_edit_layers","allow_embed_url","allow_image_url","allow_label","allow_pin_color","allow_remove","allow_zoom","connect_markers","filter_by","filter_truncate_direction","geofence","enable_user","events_type","limit","type_enable_user","infobox_config","behavior","date_format","object_fit","position","show_one_infobox","layer","layer_sub_type","markdown_box","max_points","occupy_whole_widget","show_filter","show_last_update","show_polyline","show_side_value","theme","color","background","button_background","button_icon","header","infobox_background","infobox_header","infobox_text","zoom_button_background","zoom_button_border","zoom_button_icon","tools_title","title_window","header_buttons","help","label","realtime","type","Array","isArray","item","is_hide","alias","vars_labels","numberFormat","vars_format","formula","vars_formula","varConditions","vars_conditions","varUrl","vars_url","varImage","vars_images","varEmbed","vars_embed","externalUrl","url","external_url","external_url_label","urlType","vars_link_type","override_color","url_type","number_format","color_conditions","img_pin","embed","isOldStructure","isOld","numberformat","watermark","undefined"],"sources":["C:\\Users\\yudji\\OneDrive\\Documentos\\SGA\\WIDGETS\\mqtt_wid\\dash_mqtt\\node_modules\\@tago-io\\sdk\\src\\modules\\Migration\\imagemarker.ts"],"sourcesContent":["// ? ==================================== (c) TagoIO ====================================\n// * What is this file?\n//     Migration of old IMAGE MARKER to new IMAGE MARKER\n// ? ====================================================================================\nimport { WidgetInfo } from \"../Account/dashboards.types\";\nimport { convertFormula } from \"./common\";\n\nexport function convertLayerData(widget: any, oldWidgetData: any) {\n  const fields = [];\n  const layerVariable = widget?.display?.layer_variable;\n  // Map old keys (Origin id + Variable name) to new key (Origin)\n  const mapOldToNew: any = {};\n  for (const dt of widget.data) {\n    if (\n      dt?.variables?.[0] &&\n      (layerVariable?.origin?.id !== dt?.origin || layerVariable?.variable !== dt?.variables?.[0])\n    ) {\n      const key = `${dt?.origin}${dt?.variables?.[0]}`;\n      mapOldToNew[key] = dt?.origin;\n    }\n  }\n\n  for (const x of oldWidgetData) {\n    if (\n      x?.data?.variables?.[0] &&\n      x?.data?.origin === layerVariable?.origin?.id &&\n      x?.data?.variables?.[0] === layerVariable?.variable\n    ) {\n      for (const y of x?.result) {\n        const oldFixedPos = y?.metadata?.fixed_position || {};\n        const keysFixedPos = Object.keys(oldFixedPos);\n        const newFixedPos = { ...oldFixedPos };\n        for (const k of keysFixedPos) {\n          const newK = mapOldToNew?.[k];\n          if (newK) {\n            newFixedPos[newK] = { ...oldFixedPos[k] };\n          }\n        }\n        fields.push({\n          ...y,\n          metadata: {\n            ...y?.metadata,\n            fixed_position: newFixedPos,\n          },\n        });\n      }\n    }\n  }\n  return fields;\n}\n\nexport function convert(oldWidget: any): WidgetInfo {\n  const oldDisplay = oldWidget.display || {};\n\n  const newStructure: any = {\n    dashboard: oldWidget.dashboard,\n    display: {\n      // Image marker display properties\n      allow_add: oldDisplay?.allow_add || true,\n      allow_edit: oldDisplay?.allow_move || true,\n      allow_edit_layers: oldDisplay?.allow_edit_layers || true,\n      allow_embed_url: !!oldDisplay?.allow_embed_url,\n      allow_image_url: !!oldDisplay?.allow_image_url,\n      allow_label: !!oldDisplay?.allow_label,\n      allow_pin_color: !!oldDisplay?.allow_pin_color,\n      allow_remove: oldDisplay?.allow_remove || true,\n      allow_zoom: false,\n      connect_markers: !!oldDisplay?.connect_markers,\n      filter_by: \"device\",\n      filter_truncate_direction: \"end\",\n      geofence: {\n        enable_user: false,\n        events_type: \"static\",\n        limit: 100,\n        type_enable_user: \"all\",\n      },\n      infobox_config: {\n        behavior: \"landscape\",\n        date_format: \"\",\n        object_fit: \"contain\",\n        position: \"top\",\n        show_one_infobox: true,\n      },\n      layer: oldDisplay?.layer_variable || {},\n      layer_sub_type: oldDisplay?.layer_sub_type === \"basic\" ? \"basic\" : \"advanced\",\n      markdown_box: \"\",\n      max_points: oldDisplay?.max_points || 1,\n      object_fit: \"contain\",\n      occupy_whole_widget: false,\n      show_filter: false,\n      show_last_update: false,\n      show_polyline: false,\n      show_side_value: false,\n      theme: {\n        color: {\n          background: null,\n          button_background: null,\n          button_icon: null,\n          header: null,\n          infobox_background: null,\n          infobox_header: null,\n          infobox_text: null,\n          zoom_button_background: null,\n          zoom_button_border: null,\n          zoom_button_icon: null,\n        },\n      },\n      tools_title: oldDisplay?.title_window || \"Tools\",\n\n      // Default properties for widgets\n      header_buttons: oldDisplay.header_buttons || [],\n      help: oldDisplay.help || \"\",\n      variables: [],\n    },\n    id: oldWidget.id,\n    label: oldWidget.label,\n    realtime: null,\n    type: \"image_marker\",\n  };\n\n  if (Array.isArray(oldWidget.data)) {\n    newStructure.data = oldWidget.data; // transfers the .data property\n\n    newStructure.display.variables = []; // creates the variable array\n\n    for (const item of oldWidget.data) {\n      if (item.is_hide) {\n        // is_hide items are not visible in the columns, so we cannot\n        // put them in the variables array\n        continue;\n      }\n\n      for (const variable of item.variables) {\n        const key = `${item.origin}${variable}`;\n\n        const alias = oldDisplay.vars_labels?.[key];\n        const numberFormat = oldDisplay.vars_format?.[key];\n        const formula = convertFormula(oldDisplay.vars_formula?.[key]);\n\n        const varConditions = oldDisplay?.vars_conditions?.[key];\n        const varUrl = oldDisplay?.vars_url?.[key];\n        const varImage = oldDisplay?.vars_images?.[key];\n        const varEmbed = oldDisplay?.vars_embed?.[key];\n\n        const externalUrl = varUrl\n          ? {\n              ...(varUrl?.url ? { external_url: varUrl?.url } : {}),\n              ...(varUrl?.alias ? { external_url_label: varUrl?.alias } : {}),\n            }\n          : null;\n\n        const urlType = oldDisplay?.vars_link_type?.[key];\n\n        newStructure.display.variables.push({\n          origin: item.origin,\n          override_color: !oldDisplay?.override_color,\n          url_type: urlType || \"image\",\n          variable,\n          ...(alias ? { alias } : {}),\n          ...(numberFormat ? { number_format: numberFormat } : {}),\n          ...(formula ? { formula } : {}),\n          ...(varConditions ? { color_conditions: varConditions } : {}),\n          ...(externalUrl ? { ...externalUrl } : {}),\n          ...(varImage ? { img_pin: varImage } : {}),\n          ...(varEmbed ? { embed: varEmbed } : {}),\n        });\n      }\n    }\n  }\n\n  return newStructure;\n}\n\nexport function isOldStructure(widget: any) {\n  const isOld = !!(\n    widget?.display?.vars_labels ||\n    widget?.display?.vars_formula ||\n    widget?.display?.numberformat ||\n    widget?.display?.watermark !== undefined\n  );\n\n  return isOld;\n}\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}
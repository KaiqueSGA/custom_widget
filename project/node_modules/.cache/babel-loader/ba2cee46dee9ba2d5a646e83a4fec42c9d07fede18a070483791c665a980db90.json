{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RouterConstructor = void 0;\nconst service_1 = __importDefault(require(\"./service\"));\nclass RouterConstructor {}\nexports.RouterConstructor = RouterConstructor;\nclass AnalysisRouter {\n  /**\n   * Create an Analysis Router.\n   * Use router.register to register new routes for your analysis.\n   * Use router.exec() to execute the router and run your functions.\n   * Example:\n   *      router.register(myFunction).whenInputFormID('create-device-input');\n   *      router.exec();\n   */\n  constructor(params) {\n    this.params = params;\n    this.services = [];\n  }\n  register(func) {\n    const service = new service_1.default(func);\n    this.services.push(service);\n    return service;\n  }\n  /**\n   * Start the router. It will pick the service if all conditions are match\n   * and send all parameter provided to the final function.\n   * @returns json with status and services that run\n   */\n  async exec() {\n    const my_list = [];\n    for (const service of this.services) {\n      if (!service.verifyConditionsTrue(this.params.scope, this.params.environment)) {\n        continue;\n      }\n      service.runService(this.params);\n      my_list.push(service.getServiceName());\n    }\n    return {\n      status: !!my_list.length,\n      services: my_list\n    };\n  }\n}\nexports.default = AnalysisRouter;","map":{"version":3,"mappings":";;;;;;;;;;;AAMA;AAGA,MAAMA,iBAAiB;AAgDdC;AAxCT,MAAMC,cAAc;EAGlB;;;;;;;;EAQAC,YAAoBC,MAAyB;IAAzB,WAAM,GAANA,MAAM;IAV1B,aAAQ,GAAoB,EAAE;EAUkB;EAEzCC,QAAQ,CAACC,IAA4C;IAC1D,MAAMC,OAAO,GAAG,IAAIC,iBAAa,CAACF,IAAI,CAAC;IACvC,IAAI,CAACG,QAAQ,CAACC,IAAI,CAACH,OAAO,CAAC;IAE3B,OAAOA,OAAO;EAChB;EAEA;;;;;EAKO,MAAMI,IAAI;IACf,MAAMC,OAAO,GAAa,EAAE;IAC5B,KAAK,MAAML,OAAO,IAAI,IAAI,CAACE,QAAQ,EAAE;MACnC,IAAI,CAACF,OAAO,CAACM,oBAAoB,CAAC,IAAI,CAACT,MAAM,CAACU,KAAK,EAAE,IAAI,CAACV,MAAM,CAACW,WAAW,CAAC,EAAE;QAC7E;;MAGFR,OAAO,CAACS,UAAU,CAAC,IAAI,CAACZ,MAAM,CAAC;MAC/BQ,OAAO,CAACF,IAAI,CAACH,OAAO,CAACU,cAAc,EAAE,CAAC;;IAGxC,OAAO;MAAEC,MAAM,EAAE,CAAC,CAACN,OAAO,CAACO,MAAM;MAAEV,QAAQ,EAAEG;IAAO,CAAE;EACxD;;AAIFX,kBAAeC,cAAc","names":["RouterConstructor","exports","AnalysisRouter","constructor","params","register","func","service","service_1","services","push","exec","my_list","verifyConditionsTrue","scope","environment","runService","getServiceName","status","length"],"sources":["C:\\Users\\yudji\\OneDrive\\Documentos\\SGA\\WIDGETS\\mqtt_wid\\dash_mqtt\\node_modules\\@tago-io\\sdk\\src\\modules\\Utils\\router\\router.ts"],"sourcesContent":["import { Data } from \"../../../common/common.types\";\nimport Account from \"../../Account/Account\";\nimport { MQTTResourceAction } from \"../../Account/actions.types\";\nimport { DeviceCreateInfo } from \"../../Account/devices.types\";\nimport { TagoContext } from \"../../Analysis/analysis.types\";\nimport Device from \"../../Device/Device\";\nimport RouterService from \"./service\";\n\ntype Scope = (Data | DeviceCreateInfo | { input_form_button_id: string } | MQTTResourceAction)[];\nclass RouterConstructor {\n  scope: Scope;\n  environment: { [key: string]: string };\n  account?: Account;\n  config_dev?: Device;\n  context?: TagoContext;\n}\n\nclass AnalysisRouter {\n  services: RouterService[] = [];\n\n  /**\n   * Create an Analysis Router.\n   * Use router.register to register new routes for your analysis.\n   * Use router.exec() to execute the router and run your functions.\n   * Example:\n   *      router.register(myFunction).whenInputFormID('create-device-input');\n   *      router.exec();\n   */\n  constructor(private params: RouterConstructor) {}\n\n  public register(func: (parameters: RouterConstructor) => any) {\n    const service = new RouterService(func);\n    this.services.push(service);\n\n    return service;\n  }\n\n  /**\n   * Start the router. It will pick the service if all conditions are match\n   * and send all parameter provided to the final function.\n   * @returns json with status and services that run\n   */\n  public async exec() {\n    const my_list: string[] = [];\n    for (const service of this.services) {\n      if (!service.verifyConditionsTrue(this.params.scope, this.params.environment)) {\n        continue;\n      }\n\n      service.runService(this.params);\n      my_list.push(service.getServiceName());\n    }\n\n    return { status: !!my_list.length, services: my_list };\n  }\n}\n\nexport { RouterConstructor };\nexport default AnalysisRouter;\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}
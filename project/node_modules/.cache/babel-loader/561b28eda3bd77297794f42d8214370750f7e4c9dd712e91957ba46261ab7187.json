{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isOldStructure = exports.convert = void 0;\nconst common_1 = require(\"./common/\");\nfunction convert(oldWidget) {\n  const oldDisplay = oldWidget.display || {};\n  let decimalsString = \"\";\n  if (oldDisplay?.numberformat && typeof oldDisplay?.numberformat === \"string\") {\n    decimalsString = oldDisplay?.numberformat?.split(\".\")?.[1] || \"\";\n  }\n  const decimals = decimalsString.length || -1;\n  const newStructure = {\n    dashboard: oldWidget.dashboard,\n    display: {\n      alias: \"\",\n      formula: {\n        enable: false,\n        fixed_unit: oldDisplay?.unit || \"\",\n        unit_type: \"fixed\"\n      },\n      header_buttons: oldDisplay.header_buttons || [],\n      help: oldDisplay.help || \"\",\n      max_points: oldDisplay?.max_points || 5,\n      number_format: {\n        decimals,\n        show_thousand: false\n      },\n      show_chart: !!oldDisplay?.show_chart,\n      show_unit: !!oldDisplay?.show_unit,\n      show_variables: !oldDisplay?.hide_variables,\n      theme: {\n        color: {\n          background: oldDisplay?.conditions_background || [],\n          chart: oldDisplay?.conditions_chart || [],\n          text: oldDisplay?.conditions_value || []\n        }\n      },\n      url: (0, common_1.removeHttpFromURL)(oldDisplay?.url) || \"\"\n    },\n    id: oldWidget.id,\n    label: oldWidget.label,\n    realtime: null,\n    type: \"card\"\n  };\n  if (Array.isArray(oldWidget.data)) {\n    for (const item of oldWidget.data) {\n      if (item?.is_hide) {\n        continue;\n      }\n      for (const variable of item.variables) {\n        const key = `${item?.origin}${variable}`;\n        if (oldDisplay?.vars_format?.[key]) {\n          newStructure.display.number_format = oldDisplay?.vars_format?.[key];\n        }\n        if (oldDisplay?.vars_labels?.[key] && oldDisplay?.vars_labels?.[key] !== variable) {\n          newStructure.display.alias = oldDisplay?.vars_labels?.[key];\n        }\n      }\n    }\n    newStructure.data = oldWidget.data;\n  }\n  return newStructure;\n}\nexports.convert = convert;\nfunction isOldStructure(widget) {\n  const isOld = !!(widget?.display?.vars_labels || widget?.display?.vars_format || widget?.display?.vars_formula);\n  return isOld;\n}\nexports.isOldStructure = isOldStructure;","map":{"version":3,"mappings":"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","names":["convert","oldWidget","oldDisplay","display","decimalsString","numberformat","split","decimals","length","newStructure","dashboard","alias","formula","enable","fixed_unit","unit","unit_type","header_buttons","help","max_points","number_format","show_thousand","show_chart","show_unit","show_variables","hide_variables","theme","color","background","conditions_background","chart","conditions_chart","text","conditions_value","url","id","label","realtime","type","Array","isArray","data","item","is_hide","variable","variables","key","origin","vars_format","vars_labels","exports","isOldStructure","widget","isOld","vars_formula"],"sources":["C:\\Users\\yudji\\OneDrive\\Documentos\\SGA\\WIDGETS\\custom_widgets\\project\\node_modules\\@tago-io\\sdk\\src\\modules\\Migration\\card.ts"],"sourcesContent":["// ? ==================================== (c) TagoIO ====================================\n// * What is this file?\n//     Migration of old CARD to new CARD.\n// ? ====================================================================================\nimport { WidgetInfo } from \"../Account/dashboards.types\";\nimport { removeHttpFromURL } from \"./common/\";\n\nfunction convert(oldWidget: any): WidgetInfo {\n  const oldDisplay = oldWidget.display || {};\n\n  let decimalsString = \"\";\n  if (oldDisplay?.numberformat && typeof oldDisplay?.numberformat === \"string\") {\n    decimalsString = oldDisplay?.numberformat?.split(\".\")?.[1] || \"\";\n  }\n  const decimals = decimalsString.length || -1;\n\n  const newStructure: any = {\n    dashboard: oldWidget.dashboard,\n    display: {\n      alias: \"\",\n      formula: {\n        enable: false,\n        fixed_unit: oldDisplay?.unit || \"\",\n        unit_type: \"fixed\",\n      },\n      header_buttons: oldDisplay.header_buttons || [],\n      help: oldDisplay.help || \"\",\n      max_points: oldDisplay?.max_points || 5,\n      number_format: {\n        decimals,\n        show_thousand: false,\n      },\n      show_chart: !!oldDisplay?.show_chart,\n      show_unit: !!oldDisplay?.show_unit,\n      show_variables: !oldDisplay?.hide_variables,\n      theme: {\n        color: {\n          background: oldDisplay?.conditions_background || [],\n          chart: oldDisplay?.conditions_chart || [],\n          text: oldDisplay?.conditions_value || [],\n        },\n      },\n      url: removeHttpFromURL(oldDisplay?.url) || \"\",\n    },\n    id: oldWidget.id,\n    label: oldWidget.label,\n    realtime: null,\n    type: \"card\",\n  };\n\n  if (Array.isArray(oldWidget.data)) {\n    for (const item of oldWidget.data) {\n      if (item?.is_hide) {\n        continue;\n      }\n      for (const variable of item.variables) {\n        const key = `${item?.origin}${variable}`;\n        if (oldDisplay?.vars_format?.[key]) {\n          newStructure.display.number_format = oldDisplay?.vars_format?.[key];\n        }\n\n        if (oldDisplay?.vars_labels?.[key] && oldDisplay?.vars_labels?.[key] !== variable) {\n          newStructure.display.alias = oldDisplay?.vars_labels?.[key];\n        }\n      }\n    }\n\n    newStructure.data = oldWidget.data;\n  }\n  return newStructure;\n}\n\nfunction isOldStructure(widget: any): boolean {\n  const isOld = !!(widget?.display?.vars_labels || widget?.display?.vars_format || widget?.display?.vars_formula);\n\n  return isOld;\n}\n\nexport { convert, isOldStructure };\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}